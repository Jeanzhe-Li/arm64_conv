# ARM64优化卷积计算项目

## 项目概述

本项目专注于在ARM64架构上优化卷积计算性能，通过两种主要思路实现卷积操作的加速：
1. **直接卷积优化**：通过循环展开和汇编优化提升卷积计算效率
2. **Im2col + SGEMM**：将卷积转换为矩阵乘法，利用高效的GEMM实现

以及附加实验，使用C语言实现空洞卷积并用汇编语言加速

## 项目结构

同名可执行文件均在同一目录下
```
conv/
├── C_loop_Origin.c          # 初始C语言卷积实现（基准版本）
├── 22281010_李竞喆.docx      # 实验报告
├── set1/                    # 思路一：直接卷积优化
│   ├── C_loop_Kernel3x3.c   # 3x3卷积核手动展开的C实现
│   ├── asm_loop_Kernel3x3.c # 3x3卷积核手动展开的汇编优化
│   ├── C_loop_Kernel_any.c  # 任意尺寸卷积核循环展开的C实现
│   └── asm_loop_kernel_any.c# 任意尺寸卷积核循环展开的汇编优化
├── set2/                    # 思路二：Im2col + SGEMM
│   ├── C_Sgemm_op1.c        # 基础版本，未进行矩阵乘法展开
│   ├── C_Sgemm_op4.c        # 1×4矩阵乘法展开的C实现
│   ├── asm_Sgemm_op4.c      # 1×4矩阵乘法展开的汇编优化
│   ├── C_Sgemm_op16.c       # 4×4矩阵乘法展开的C实现
│   └── asm_Sgemm_op16.c     # 4×4矩阵乘法展开的汇编优化
└── set3/                    # 附加实验：空洞卷积
    ├── C_delated.c          # 基础版本
    └── asm_delated.c        # 汇编优化
```

## 实现思路详解

### 基准实现
- **C_loop_Origin.c**：原始的C语言卷积实现，作为性能对比的基准

### 思路一：直接卷积优化

#### ① 3×3卷积核优化
- **C_loop_Kernel3x3.c**：针对3×3卷积核进行手动循环展开，减少循环开销
- **asm_loop_Kernel3x3.c**：在C版本基础上使用ARM64汇编指令进一步优化，充分利用SIMD指令集

#### ② 任意尺寸卷积核优化
- **C_loop_Kernel_any.c**：支持任意尺寸卷积核的循环展开优化
- **asm_loop_kernel_any.c**：通用卷积核的汇编优化版本，提供更好的灵活性

### 思路二：Im2col + SGEMM优化

将卷积操作转换为矩阵乘法，利用高度优化的GEMM（通用矩阵乘法）实现：

#### ① 基础版本
- **C_Sgemm_op1.c**：Im2col转换后的基础矩阵乘法实现，未进行额外优化

#### ② 1×4展开优化
- **C_Sgemm_op4.c**：每次处理1×4的矩阵块，提高数据重用率
- **asm_Sgemm_op4.c**：1×4展开的汇编优化版本，使用向量指令加速

#### ③ 4×4展开优化
- **C_Sgemm_op16.c**：每次处理4×4的矩阵块（16个元素），最大化寄存器利用率
- **asm_Sgemm_op16.c**：4×4展开的汇编优化版本，充分利用ARM64的NEON指令集

## 优化技术

1. **循环展开**：减少循环控制开销，提高指令级并行度
2. **SIMD指令**：使用ARM64 NEON指令集进行向量化计算
3. **寄存器优化**：合理分配寄存器，减少内存访问
4. **数据重用**：通过分块策略提高缓存命中率
5. **Im2col转换**：将卷积问题转化为高效的矩阵乘法问题

## 附加实验优化技术

综合运用了寄存器优化、指令级优化、分支预测优化、内存访问优化等等，既是创新实验，又是对以上优化方法的总结与综合运用

## 编译与运行

您需要使用您的mac，直接在终端输入以下命令即可

### 编译命令示例
```zsh
# 编译基准版本
clang -o C_loop_Origin C_loop_Origin.c 

# 编译优化版本
clang -o ./set2/asm_Sgemm_op16 ./set2/asm_Sgemm_op16.c 
```

### 运行示例
```zsh
./C_loop_Origin
./set1/asm_loop_Kernel3x3
./set2/asm_Sgemm_op16
```

## 性能对比

详细图表位于实验报告中，请您查阅

## 注意事项

- 本项目针对ARM64架构优化，在其他架构上可能无法编译或运行
- 汇编优化版本依赖于特定的ARM64指令集特性
- 建议在支持NEON的ARM64处理器上运行以获得最佳性能
